<!DOCTYPE html>
<html lang="ru" class="hidden">

@@include('./blocks/main/_head2.html', {
"title": "Works",
})

<body class="works" data-barba="wrapper" data-scroll-container>

    <!-- @@include('./blocks/_preloader-page.html') -->

    <!-- barba loadind screen  -->
    @@include('./blocks/main/_barba-loading.html')

    <!-- header -->
    @@include('./blocks/main/_header.html')


    <main data-barba="container" data-barba-namespace="works">

        @@include('./blocks/main/_menu.html', {
        "home": "",
        "about": "",
        "works": "active",
        "contact": "",
        })


        <!-- projects
        ======================================================= -->
        <section id="slider" class="projects">

            <div class="slider-inner">
                <div id="slider-content">
                    <!-- <div class="meta">Species</div> -->

                    <div class="projects__title">
                        <h2 id="slide-title">
                            <span>Clothing</span>
                            <span>Store</span>
                        </h2>

                        <div class="slide-hidden" data-slide-title="0">
                            <span>Clothing</span>
                            <span>Store</span>
                        </div>
                        <div class="slide-hidden" data-slide-title="1">
                            <span>Clothing2</span>
                            <span>Store2</span>
                        </div>
                        <div class="slide-hidden" data-slide-title="2">
                            <span>Clothing2</span>
                            <span>Store2</span>
                        </div>
                        <div class="slide-hidden" data-slide-title="3">
                            <span>Clothing2</span>
                            <span>Store2</span>
                        </div>
                    </div>

                    <div class="projects__text">
                        <p id="slider-text">
                            Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled
                        </p>

                        <div class="slide-hidden" data-slide-text="0">
                            Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled
                        </div>
                        <div class="slide-hidden" data-slide-text="1">
                            Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled
                        </div>
                        <div class="slide-hidden" data-slide-text="2">
                            Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled
                        </div>
                        <div class="slide-hidden" data-slide-text="3">
                            Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled
                        </div>
                    </div>

                    <div class="projects__num">01</div>
                    <!-- <div class="meta">Status</div> -->

                    <!-- <div id="slide-status">Critically Endangered</div>

                    <span data-slide-status="0">Critically Endangered</span>
                    <span data-slide-status="1">Endangered</span>
                    <span data-slide-status="2">Endangered</span>
                    <span data-slide-status="3">Least Concern</span> -->

                    <div class="slider__videos">
                        <video class="slide__video" data-slide-video="0" preload="auto" autoplay no-controls loop playsinline muted>
                            <source src="./loader-video.mp4" type='video/mp4' />
                        </video>
                        <video class="slide__video" data-slide-video="1" preload="auto" autoplay no-controls loop playsinline muted>
                            <source src="./video2.mp4" type='video/mp4' />
                        </video>
                        <video class="slide__video" data-slide-video="2" preload="auto" autoplay no-controls loop playsinline muted>
                            <source src="./loader-video.mp4" type='video/mp4' />
                        </video>
                        <video class="slide__video" data-slide-video="3" preload="auto" autoplay no-controls loop playsinline muted>
                            <source src="./video2.mp4" type='video/mp4' />
                        </video>
                    </div>


                    <svg width="20" height="20" class="projects__pattern1">
                        <use xlink:href="./img/icons/icons.svg#leaves1" />
                    </svg>

                    <svg width="20" height="20" class="projects__pattern2">
                        <use xlink:href="./img/icons/icons.svg#leaves2" />
                    </svg>

                    <div class="projects__pattern3"></div>
                    
                    <p class="projects__vertical">Lorem ipsum dolor sit amet</p>
                </div>

                <div class="projects__images">
                    <img src="img/project2.jpg" />
                    <img src="img/project1.jpg" />
                    <img src="img/hypercritical__img.jpg" />
                    <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/123024/bear2.jpg" />
                </div>
            </div>


            <div id="pagination" class="projects__pagination">
                <button class="active" data-slide="0"></button>
                <button data-slide="1"></button>
                <button data-slide="2"></button>
                <button data-slide="3"></button>
            </div>

            <div class="projects__arrows">
                <div class="projects__arrow btn-right">
                    <svg width="20" height="20">
                        <use xlink:href="./img/icons/icons.svg#back" />
                    </svg>
                </div>
                <div class="projects__arrow btn-left">
                    <svg width="20" height="20">
                        <use xlink:href="./img/icons/icons.svg#next" />
                    </svg>
                </div>
            </div>

        </section>
        <!-- projects end -->

    </main>

    <!-- Global Scripts -->
    @@include('./blocks/main/_js.html')

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r79/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.1/TweenMax.min.js"></script>

    <!-- preloader -->
    <script>
        $(document).ready(function () {
            const LANDING = {};
            LANDING.intro = document.querySelector(".preloader-page");
            LANDING.path = LANDING.intro.querySelector("path");

            const svgAnimation = () => {
                console.log("Animation");

                anime({
                    targets: LANDING.intro,
                    duration: 2000,
                    easing: "easeInOutSine",
                    translateY: "-200vh"
                });

                anime({
                    targets: LANDING.path,
                    duration: 1500,
                    easing: "easeInOutSine",
                    d: LANDING.path.getAttribute("pathdata:id")
                });
            };
            svgAnimation();
        })
    </script>
    <!-- slider -->
    <script>

        const displacementSlider = function (opts) {

            let vertex = `
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    }
`;

            let fragment = `
    
    varying vec2 vUv;

    uniform sampler2D currentImage;
    uniform sampler2D nextImage;

    uniform float dispFactor;

    void main() {

        vec2 uv = vUv;
        vec4 _currentImage;
        vec4 _nextImage;
        float intensity = 0.3;

        vec4 orig1 = texture2D(currentImage, uv);
        vec4 orig2 = texture2D(nextImage, uv);
        
        _currentImage = texture2D(currentImage, vec2(uv.x, uv.y + dispFactor * (orig2 * intensity)));

        _nextImage = texture2D(nextImage, vec2(uv.x, uv.y + (1.0 - dispFactor) * (orig1 * intensity)));

        vec4 finalTexture = mix(_currentImage, _nextImage, dispFactor);

        gl_FragColor = finalTexture;

    }
`;

            let images = opts.images, image, sliderImages = [];;
            let canvasWidth = images[0].clientWidth;
            let canvasHeight = images[0].clientHeight;
            // console.log(document.body.clientHeight - 50)
            // let canvasWidth = document.body.clientWidth * 0.6;
            // let canvasHeight = document.body.clientHeight * 1;
            let parent = opts.parent;
            // let renderWidth = window.innerWidth * 0.6;
            let renderWidth = window.innerWidth * 0.6;
            let renderHeight = window.innerHeight;
            // let renderWidth = document.body.clientWidth * 0.60;
            // let renderHeight = document.body.clientHeight - 30;
            // let renderHeight = window.innerHeight;

            let renderW, renderH;

            if (renderWidth > canvasWidth) {
                renderW = renderWidth;
            } else {
                renderW = canvasWidth;
            }
            // renderW = renderWidth;
            renderH = canvasHeight;

            let renderer = new THREE.WebGLRenderer({
                antialias: false,
            });

            renderer.setPixelRatio(window.devicePixelRatio);
            // renderer.setClearColor(0x, 1.0);
            renderer.setSize(renderW, renderH);
            parent.appendChild(renderer.domElement);

            let loader = new THREE.TextureLoader();
            loader.crossOrigin = "anonymous";

            images.forEach((img) => {

                image = loader.load(img.getAttribute('src') + '?v=' + Date.now());
                image.magFilter = image.minFilter = THREE.LinearFilter;
                image.anisotropy = renderer.capabilities.getMaxAnisotropy();
                sliderImages.push(image);

            });

            let scene = new THREE.Scene();
            // scene.background = new THREE.Color(0x23272A, 1);
            let camera = new THREE.OrthographicCamera(
                renderWidth / -2,
                renderWidth / 2,
                renderHeight / 2,
                renderHeight / -2,
                1,
                1000
            );

            camera.position.z = 1;

            let mat = new THREE.ShaderMaterial({
                uniforms: {
                    dispFactor: { type: "f", value: 0.0 },
                    currentImage: { type: "t", value: sliderImages[0] },
                    nextImage: { type: "t", value: sliderImages[1] },
                },
                vertexShader: vertex,
                fragmentShader: fragment,
                transparent: true,
                opacity: 1.0
            });

            let geometry = new THREE.PlaneBufferGeometry(
                renderW,
                renderH,
                1
            );
            let object = new THREE.Mesh(geometry, mat);
            object.position.set(0, 0, 0);
            scene.add(object);


            let addEvents = function () {

                let pagButtons = Array.from(document.getElementById('pagination').querySelectorAll('button'));
                let isAnimating = false;

                pagButtons.forEach((el) => {

                    el.addEventListener('click', function () {

                        if (!isAnimating) {

                            isAnimating = true;

                            document.getElementById('pagination').querySelectorAll('.active')[0].className = '';
                            this.className = 'active';

                            let slideId = parseInt(this.dataset.slide, 10);

                            mat.uniforms.nextImage.value = sliderImages[slideId];
                            mat.uniforms.nextImage.needsUpdate = true;

                            TweenLite.to(mat.uniforms.dispFactor, 1, {
                                value: 1,
                                ease: 'Expo.easeInOut',
                                onComplete: function () {
                                    mat.uniforms.currentImage.value = sliderImages[slideId];
                                    mat.uniforms.currentImage.needsUpdate = true;
                                    mat.uniforms.dispFactor.value = 0.0;
                                    isAnimating = false;
                                }
                            });

                            let slideTitleEl = document.getElementById('slide-title');
                            let slideStatusEl = document.getElementById('slide-status');
                            let nextSlideTitle = document.querySelectorAll(`[data-slide-title="${slideId}"]`)[0].innerHTML;
                            let nextSlideStatus = document.querySelectorAll(`[data-slide-status="${slideId}"]`)[0].innerHTML;


                            $('.slide__video').css('display', 'none');
                            $(`.slide__video[data-slide-video="${slideId}"]`).css('display', 'block');

                            TweenLite.fromTo(slideTitleEl, 0.5,
                                {
                                    autoAlpha: 1,
                                    y: 0
                                },
                                {
                                    autoAlpha: 0,
                                    y: 20,
                                    ease: 'Expo.easeIn',
                                    onComplete: function () {
                                        slideTitleEl.innerHTML = nextSlideTitle;

                                        TweenLite.to(slideTitleEl, 0.5, {
                                            autoAlpha: 1,
                                            y: 0,
                                        })
                                    }
                                });

                            TweenLite.fromTo(slideStatusEl, 0.5,
                                {
                                    autoAlpha: 1,
                                    y: 0
                                },
                                {
                                    autoAlpha: 0,
                                    y: 20,
                                    ease: 'Expo.easeIn',
                                    onComplete: function () {
                                        slideStatusEl.innerHTML = nextSlideStatus;

                                        TweenLite.to(slideStatusEl, 0.5, {
                                            autoAlpha: 1,
                                            y: 0,
                                            delay: 0.1,
                                        })
                                    }
                                });

                        }

                    });

                });

                // var scrollPos = 0;
                // $(window).scroll(function () {
                //     var st = $(this).scrollTop();
                //     if (st > scrollPos) {
                //         console.log('вниз')
                //         $("body").css("background-color", "red");



                //     } else {
                //         console.log('вверх')
                //         $("body").css("background-color", "yellow");
                //     }
                //     scrollPos = st;
                // });

                $('.btn-left').click(function () {


                    let numberActive = parseInt($('#pagination').find('.active').attr('data-slide')) + 1;

                    let slidesLenght = parseInt($('#pagination button').length)

                    if (numberActive == slidesLenght) {
                        numberActive = 0;
                    }

                    if (!isAnimating) {

                        isAnimating = true;

                        document.getElementById('pagination').querySelectorAll('.active')[0].className = '';

                        $('#pagination').find(`button:nth-child(${numberActive + 1})`).addClass('active')
                        // document.getElementById('pagination').querySelectorAll('button')[numberActive + 1].className = 'active';
                        // this.className = 'active';

                        console.log();

                        let slideId = numberActive;

                        mat.uniforms.nextImage.value = sliderImages[slideId];
                        mat.uniforms.nextImage.needsUpdate = true;

                        TweenLite.to(mat.uniforms.dispFactor, 1, {
                            value: 1,
                            ease: 'Expo.easeInOut',
                            onComplete: function () {
                                mat.uniforms.currentImage.value = sliderImages[slideId];
                                mat.uniforms.currentImage.needsUpdate = true;
                                mat.uniforms.dispFactor.value = 0.0;
                                isAnimating = false;
                            }
                        });

                        let slideTitleEl = document.getElementById('slide-title');
                        let slideStatusEl = document.getElementById('slide-status');
                        let nextSlideTitle = document.querySelectorAll(`[data-slide-title="${slideId}"]`)[0].innerHTML;
                        let nextSlideStatus = document.querySelectorAll(`[data-slide-status="${slideId}"]`)[0].innerHTML;

                        TweenLite.fromTo(slideTitleEl, 0.5,
                            {
                                autoAlpha: 1,
                                y: 0
                            },
                            {
                                autoAlpha: 0,
                                y: 20,
                                ease: 'Expo.easeIn',
                                onComplete: function () {
                                    slideTitleEl.innerHTML = nextSlideTitle;

                                    TweenLite.to(slideTitleEl, 0.5, {
                                        autoAlpha: 1,
                                        y: 0,
                                    })
                                }
                            });

                        TweenLite.fromTo(slideStatusEl, 0.5,
                            {
                                autoAlpha: 1,
                                y: 0
                            },
                            {
                                autoAlpha: 0,
                                y: 20,
                                ease: 'Expo.easeIn',
                                onComplete: function () {
                                    slideStatusEl.innerHTML = nextSlideStatus;

                                    TweenLite.to(slideStatusEl, 0.5, {
                                        autoAlpha: 1,
                                        y: 0,
                                        delay: 0.1,
                                    })
                                }
                            });

                    }


                });

                $('.btn-right').click(function () {

                    let numberActive = parseInt($('#pagination').find('.active').attr('data-slide')) - 1;

                    let slidesLenght = parseInt($('#pagination button').length)
                    // console.log(slidesLenght)

                    if (numberActive < 0) {
                        numberActive = slidesLenght - 1;
                    }

                    if (!isAnimating) {

                        isAnimating = true;

                        document.getElementById('pagination').querySelectorAll('.active')[0].className = '';

                        $('#pagination').find(`button:nth-child(${numberActive + 1})`).addClass('active')
                        // document.getElementById('pagination').querySelectorAll('button')[numberActive + 1].className = 'active';
                        // this.className = 'active';

                        console.log();

                        let slideId = numberActive;

                        mat.uniforms.nextImage.value = sliderImages[slideId];
                        mat.uniforms.nextImage.needsUpdate = true;

                        TweenLite.to(mat.uniforms.dispFactor, 1, {
                            value: 1,
                            ease: 'Expo.easeInOut',
                            onComplete: function () {
                                mat.uniforms.currentImage.value = sliderImages[slideId];
                                mat.uniforms.currentImage.needsUpdate = true;
                                mat.uniforms.dispFactor.value = 0.0;
                                isAnimating = false;
                            }
                        });

                        let slideTitleEl = document.getElementById('slide-title');
                        let slideStatusEl = document.getElementById('slide-status');
                        let nextSlideTitle = document.querySelectorAll(`[data-slide-title="${slideId}"]`)[0].innerHTML;
                        let nextSlideStatus = document.querySelectorAll(`[data-slide-status="${slideId}"]`)[0].innerHTML;

                        TweenLite.fromTo(slideTitleEl, 0.5,
                            {
                                autoAlpha: 1,
                                y: 0
                            },
                            {
                                autoAlpha: 0,
                                y: 20,
                                ease: 'Expo.easeIn',
                                onComplete: function () {
                                    slideTitleEl.innerHTML = nextSlideTitle;

                                    TweenLite.to(slideTitleEl, 0.5, {
                                        autoAlpha: 1,
                                        y: 0,
                                    })
                                }
                            });

                        TweenLite.fromTo(slideStatusEl, 0.5,
                            {
                                autoAlpha: 1,
                                y: 0
                            },
                            {
                                autoAlpha: 0,
                                y: 20,
                                ease: 'Expo.easeIn',
                                onComplete: function () {
                                    slideStatusEl.innerHTML = nextSlideStatus;

                                    TweenLite.to(slideStatusEl, 0.5, {
                                        autoAlpha: 1,
                                        y: 0,
                                        delay: 0.1,
                                    })
                                }
                            });

                    }


                });


            };

            addEvents();

            window.addEventListener('resize', function (e) {
                renderer.setSize(renderW, renderH);
            });

            let animate = function () {
                requestAnimationFrame(animate);

                renderer.render(scene, camera);
            };
            animate();
        };




        const el = document.getElementById('slider');
        const imgs = Array.from(el.querySelectorAll('img'));
        new displacementSlider({
            parent: el,
            images: imgs
        });
    </script>
    <!-- video play -->
    <script>
        $('.projects__img').hover(function () {
            setTimeout(() => {
                $(this).find("#projects__video")[0].play();
            }, 1000);
        });
        $(document).on('click', '.projects__img', function () {
            var video = $(this).find("#projects__video")[0];
            if (video.paused) {
                video.play();
            } else {
                video.pause();
            }
        });
    </script>

</body>

</html>